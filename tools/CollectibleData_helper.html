<html>
    <head>
        <title>Met API Helper Tools</title>
        <style>
            textarea {
                font-family: monospace;
            }
        </style>
    </head>
    <body>
        This tool builds the CollectibleData list. Wonders should have a blank line between them.
        <br>
        <textarea id="input" rows="15" cols="80">
chichenItza, Mayan
'701645',
'310555',
'286467',

christRedeemer, UNKNOWN

colosseum, Roman
'245376',
'256570',
'286136',

greatWall, Chinese

machuPicchu, Inca

petra, Nabataean

pyramidsGiza, Egyptian

tajMahal, Mughal
        </textarea>
        <br>
        <input type="button" onclick="run();" value="RUN">
        <br>
        <textarea id="output" rows="15" cols="80">Output here.</textarea>
        <script>
let wonders, wonderIndex, artifactIndex;
function run() {
    let wonderStrs = input.value.split('\n\n');
    wonders = [];
    for (let i=0; i<wonderStrs.length; i++) {
        let o = wonders[i] = {};
        let lineStrs = wonderStrs[i].split('\n');
        parseInfo(lineStrs[0], o);
        parseArtifacts(lineStrs.slice(1), o);
    }
    wonderIndex = artifactIndex = 0;
    loadNext();
}

function parseInfo(str, o) {
    if (str.trim().length < 1) { return; }
    let values = str.split(",");
    o.type = values[0].trim();
    o.culture = values[1].trim();
}

function parseArtifacts(strs, o) {
    let artifacts = [];
    for (let i=0; i<strs.length; i++) {
        let str = strs[i].replace(/[^\d]/g, '');
        if (str) { artifacts.push(str); }
    }
    o.artifacts = artifacts;
}

function loadNext() {
    if (wonderIndex >= wonders.length) { return out(); }
    let wonder = wonders[wonderIndex], artifacts = wonder.artifacts;
    if (artifactIndex >= artifacts.length) {
        wonderIndex++;
        artifactIndex = 0;
        return loadNext();
    }
    output.value = `Loading data for ${wonder.type} artifact #${artifactIndex}`;
    let id = artifacts[artifactIndex];
    fetch(`https://collectionapi.metmuseum.org/public/collection/v1/objects/${id}`)
        .then(response => validateResponse(response));
}

function validateResponse(response) {
    response.json().then(data => parseArtifactData(data));
}

function parseArtifactData(data) {
    let wonder = wonders[wonderIndex], o = wonder.artifacts[artifactIndex];
    wonder.artifacts[artifactIndex] = data;
    //console.log(data);
    artifactIndex++;
    loadNext();
}

let icons = ['silhouette', 'foo'];
function out() {
    // other possibly useful props: objectDate, culture, primaryImageSmall
    let str = '', iconIndex = 0;
    for (let i=0; i<wonders.length; i++) {
        let wonder = wonders[i], artifacts = wonder.artifacts;
        str += `// ${wonder.type}\n`;
        for (let j=0; j<artifacts.length; j++) {
            let o = artifacts[j];
            let icon = icons[(iconIndex++) % icons.length];
            str += 
`CollectibleData(
  title: '${o.title}',
  subtitle: '${wonder.culture}',
  wonder: WonderType.${wonder.type},
  artifactId: '${o.objectID}',
  imageUrl: '${o.primaryImage}',
  icon: AssetImage('\${ImagePaths.collectibles}/${icon}.png'),
),\n`;
        }
        str += "\n";
    }
    output.value = str;
}
        </script>
    </body>
</html>